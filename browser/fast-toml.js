var TOML=function(){'use strict';let a="",b=0;function c(a,b=0){let c;while((c=a[b++])&&(c==' '||c=='\t'||c=='\r'));;return b-1}function d(a){switch(a[0]){case undefined:return'';case '"':return e(a.slice(1,-1));case "'":return a.slice(1,-1);case '0':;case '1':;case '2':;case '3':;case '4':;case '5':;case '6':;case '7':;case '8':;case '9':;case '+':;case '-':;case '.':let b=a;b.indexOf('_')!=-1&&(b=b.replace(/_/g,''));if(!isNaN(b))return+b;if(a[4]=='-'&&a[7]=='-'){let b=new Date(a);if(b.toString()!='Invalid Date')return b}else if(a[2]==':'&&a[5]==':'&&a.length>=7){let b=new Date('0000-01-01T'+a+'Z');if(b.toString()!='Invalid Date')return b};return a};switch(a){case 'true':return !0;case 'false':return !1;case 'nan':;case 'NaN':return !1;case 'null':return null;case 'inf':;case '+inf':;case 'Infinity':;case '+Infinity':return Infinity;case '-inf':;case '-Infinity':return-Infinity};return a}function e(a){let b,c=0,d='';while(b=a.indexOf('\\',c)+1){d+=a.slice(c,b-1);switch(a[b]){case '\\':d+='\\';break;case '"':d+='"';break;case '\r':a[b+1]=='\n'&&b++;case '\n':break;case 'b':d+='\b';break;case 't':d+='\t';break;case 'n':d+='\n';break;case 'f':d+='\f';break;case 'r':d+='\r';break;case 'u':d+=String.fromCharCode(parseInt(a.substr(b+1,4),16));b+=4;break;case 'U':d+=String.fromCharCode(parseInt(a.substr(b+1,8),16));b+=8;break;default:throw f(a[b])};c=b+1}return d+a.slice(c)}function f(a){let b=h(),c=String(b.line);a+='\n'+c+' |  '+b.lineContent+'\n';a+=' '.repeat(c.length+b.column+2)+'^';return SyntaxError(a)}function g(a,c=0,d=!1){let e=a[c],h,i=e,j=e,k=!0,l=!1;switch(e){case '"':;case "'":h=c+1;d&&a[c+1]==e&&a[c+2]==e?(j=e+e+e,h+=2):(l=!0);if(e=="'")h=a.indexOf(j,h)+1;else while(h=a.indexOf(j,h)+1){let b=!0,c=h-1;while(a[--c]=='\\')b=!b;if(b)break};if(!h)throw f("Missing "+j+" closer");if(e!=j)h+=2;else if(l){let d=a.indexOf('\n',c+1)+1;if(d&&d<h){b=d-2;throw f("Forbidden end-of-line character in single-line string")}};return h;case '(':j=')';break;case '{':j='}';break;case '[':j=']';break;case '<':j='>';break;default:k=!1};let m=0;while(e=a[++c]){if(e==j){if(m==0)return c+1;m--}else if(e=='"'||e=="'"){let b=g(a,c,d);c=b-1}else k&&e==i&&m++}throw f("Missing "+j)}function h(){let c=a[b],d=b;c=='\n'&&d--;let e=1,f=a.lastIndexOf('\n',d),g=a.indexOf('\n',d);g==-1&&(g=Infinity);(c==','||c=='\n')&&(d=f+1);if(f==-1)return{line:e,column:d+1,position:d,lineContent:a.slice(0,g).trim()};let h=d-f+1,i=a.slice(f+1,g).trim();e++;while((f=a.lastIndexOf('\n',f-1))!=-1)e++;return{line:e,column:h,position:d,lineContent:i}}function i(a){typeof a!='string'&&(a=String(a));let b=-1,c='',d=[],e,h;while(h=a[++b])switch(h){case '.':if(!c)throw f('Unexpected "."');d.push(c);c='';continue;case '"':;case "'":e=g(a,b);if(e==b+2)throw f('Empty string key');c+=a.slice(b+1,e-1);b=e-1;continue;default:c+=h};c&&d.push(c);return d}function j(a,b=[]){for(let c of b){if(!(c in a))a[c]={};else if(typeof a[c]!='object'){let a='["'+b.slice(0,b.indexOf(c)+1).join('"].["')+'"]';throw f(a+' must be an object')};a=a[c]}return a}class k{constructor(a={}){this.data=a;this.scopeList=[]}getCurrentScope(){return this.scopeList[this.scopeList.length-1]}getFullScope(a=null){let b=[];for(let a of this.scopeList)b=b.concat(a.elements);a&&(b=b.concat(a));return b}set(a,b){let c=i(a);a=c.pop();let d=this.getFullScope(c),e=j(this.data,d);if(typeof e=='string')return e;e[a]=b}push(a){if(!this.scopeList.length){if(!Array.isArray(this.data)){let a=this.data;this.data=[];Object.assign(this.data,a)}this.data.push(a);return this.data}let b=this.getFullScope(),c=b.pop(),d=j(this.data,b);if(typeof d=='string')return d;let e=d[c];switch(typeof e){case 'object':if(Array.isArray(e))break;case undefined:d[c]=Array();Object.assign(d[c],e);e=d[c];break;default:return'["'+b.join('"].["')+'"].["'+c+'"] must be an object'};e.push(a);return e}use(a){let b=l(a),c=this.getCurrentScope();c&&c.isGlobal&&this.scopeList.pop();this.scopeList.push(b);j(this.data,this.getFullScope())}useArray(a){this.use(a);let b=this.push({}),c=b.length-1;this.use(a+'.'+c)}enter(a,b=!1){this.scopeList.push(m(a.trimEnd()));let c=this.getFullScope(),d=c.pop(),e=j(this.data,c);(d in e)||(e[d]=b?[]:{})}enterArray(a=!1){let b=this.push(a?[]:{});this.scopeList.push(m(b.length-1))}exit(){let a;while((a=this.scopeList.pop())&&a.isGlobal);}}let l=a=>({isGlobal:!0,elements:i(a)}),m=a=>({isInline:!0,elements:i(a)});function n(e){typeof e!='string'&&(e=String(e));let h=new k,i=[];a=e;b=0;let j='',l='',m,n,o=a[0],p=!0,q=()=>{if(p)j&&h.push(d(j.trimEnd()));else{if(!l)throw f("Expecting value after =");h.set(j.trimEnd(),d(l.trimEnd()))}j='';l='';p=!0};do{switch(o){case ' ':p?(j&&(j+=o)):l&&(l+=o);case '\t':;case '\r':continue;case '#':b=a.indexOf('\n',b+1)-1;b==-2&&(b=Infinity);continue;case '"':;case "'":if(!p&&l){l+=o;continue};let d=a[b+1]==o&&a[b+2]==o;m=g(a,b,!0);if(p){if(j)throw f('Unexpected '+o);d?(j+=a.slice(b+2,m-2)):(j+=a.slice(b,m));b=m}else l=a.slice(b,m),b=m,d&&(l=l.slice(2,-2),l[1]=='\n'?(l=l[0]+l.slice(2)):l[1]=='\r'&&l[2]=='\n'&&(l=l[0]+l.slice(3)));b=c(a,b);o=a[b];if(o&&o!=','&&o!='\n'&&o!='#'&&o!='}'&&o!=']'&&o!='=')throw f("Unexpected character after end of string");b--;continue;case '\n':;case ',':;case undefined:q();continue;case '[':;case '{':n=o=='['?']':'}';if(p&&!i.length){if(j)throw f("Unexpected "+o);m=g(a,b);if(a[b+1]==o){if(a[m-2]!=n)throw f("Missing "+n+n);h.useArray(a.slice(b+2,m-2))}else h.use(a.slice(b+1,m-1));b=m}else if(p){if(j)throw f("Unexpected "+o);h.enterArray(o=='[');i.push(n)}else{if(l)throw f("Unexpected "+o);h.enter(j,o=='[');i.push(n);j='';p=!0};continue;case ']':;case '}':j&&q();if(i.pop()!=o)throw f("Unexpected "+o);h.exit();b=c(a,b+1);o=a[b];if(o&&o!=','&&o!='\n'&&o!='#'&&o!='}'&&o!=']')throw f("Unexpected character after end of scope");b--;continue;case '=':if(p){if(!j)throw f("Missing key before "+o);p=!1}else throw f("Unexpected "+o);continue;default:p?(j+=o):(l+=o)}}while((o=a[++b])||j);if(i.length)throw f("Missing "+i.pop());return h.data}let o=null,p=null;function q(){let a='';for(let b of arguments)a+=typeof b=='string'?b:b[0];return HUML.parse(a)}q.parse=n;q.parseFile=async function(a){o||(o=require('fs'));if(!p){let{promisify:a}=require('util');p=a(o.readFile)}let b=await p(a);return n(b)};q.parseFileSync=function(a){o||(o=require('fs'));return n(o.readFileSync(a))};return q}()
